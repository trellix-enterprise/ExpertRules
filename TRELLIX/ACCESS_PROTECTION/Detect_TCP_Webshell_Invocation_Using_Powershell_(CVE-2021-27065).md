# Detect TCP Webshell Invocation Using Powershell (CVE-2021-27065)

## Author
Trellix

## Description
This expert rule detects tcp webshell invocation using powershell to detect the vulnerability CVE-2021-27065, which is a part of the Microsoft Exchange Server based Remote Code Execution attack chain.

## Rule Class 
Processes

## Rule TCL
```tcl
Rule {
	Process {
        Include OBJECT_NAME {
            -v cmd.exe
			-v "**powershell**"
        }
    }
    Target {
        Match PROCESS {
			Include AggregateMatch -xtype "switch1"	{
				Include PROCESS_CMD_LINE { -v "**Add-PSSnapin**" }
			}
			Include AggregateMatch -xtype "switch2"	{
				Include PROCESS_CMD_LINE { -v "**Microsoft.Exchange.Powershell.Snapin**" }
			}		  
			Include -access "CREATE"
		}
	}
}

```

## Trigger
NA

## Tested Platforms
OS: Windows Server 2016, Windows Server 2019
ENS: 10.7.0 November'20 update

## Notes
Customers are advised to fine-tune the rule in their environment or disable the signature if there are false positives.